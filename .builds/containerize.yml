image: archlinux
packages:
- hugo
- git
- docker
secrets:
- 1e12461a-ef10-4f9c-b15f-2b860efc96fe
- daeb0d25-e9fc-4049-b292-08dde2b44829
- b70532da-36cc-4aff-a4e1-88c2145181aa
sources:
- git@git.sr.ht:~nykma/hugo
tasks:
  - build: |
      sudo systemctl start docker
      cd hugo
      git submodule update --init
      hugo --gc --minify
      hugo --gc --minify
  - publish: |
      cd hugo
      tag="docker.pkg.github.com/nykma/nyk.moe:latest"
      sudo docker build -t $tag .
      cat ~/.github-token | sudo docker login docker.pkg.github.com -u nykma --password-stdin
      sudo docker push $tag
