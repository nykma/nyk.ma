image: archlinux
packages:
  - hugo
  - rsync
secrets:
  - daeb0d25-e9fc-4049-b292-08dde2b44829
  - b70532da-36cc-4aff-a4e1-88c2145181aa
sources:
  - git@git.sr.ht:~nykma/hugo
environment:
  remote_dir: /var/www/hugo/
tasks:
  - build: |
      cd hugo
      git submodule update --init
      hugo --gc --minify
      hugo --gc --minify
  - publish: |
      cd hugo
      sshopts="ssh -o StrictHostKeyChecking=no"
      rsync --rsh="$sshopts" -a --delete public/ remote:$remote_dir
