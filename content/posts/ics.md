---
title: Windows使用自带「连接共享」失效的问题
author: ["Nyk Ma"]
categories: ["network"]
draft: false
date: 2014-06-28
---

> 快毕业了，同学的电脑们也开始蹦跶了。

## 问题描述

* 使用`netsh`将有线的教育网通过笔记本 wi-fi 共享给手机，原先一直工作正常，但在某次开机后失效，症状为手机浏览器一直转菊花。
* 最后一次正确配置时未对电脑做任何改动（同学如是说）。
* 目标环境：Windows 7、有线网采用802.1X验证(MD5)

## 排错流程

* 检查笔记本有线连接，可以连通外网。
* 将我自己的笔记本通过 wi-fi 连接至目标笔记本，可以被正确DHCP（192.168.137.0/24），能ping通笔记本无线网卡（192.168.137.1）。
* 尝试ping有线网卡的IP（115.154.x.x），成功。
* 尝试ping外网服务器，全部timeout。但注意到域名被正确解析了，再加上从机DNS已被DHCP为192.168.137.1，因此初步怀疑无线和有线未打通，即「Internet连接共享（ICS）」失效。
* 重启电脑、重设连接共享、重设wi-fi热点，均无效。
* 查阅资料发现ICS依赖一些服务。进入`services.msc`，查找`Internet Connection Sharing (ICS)`，发现其为「停止」状态。启动之，出口立刻被打通。

至此，故障解决。

## 原因

初步分析为某卫士在作系统优化时关闭了该服务。已建议该同学卸载此应用。

## 总结

* 在「网络和共享中心」设置ICS时，Windows居然没有提示其服务没有打开，实在是匪夷所思。
* 忽视了「服务」对Windows功能控制的重要性。
* 我不信第三方软件商能比微软还懂Windows。
